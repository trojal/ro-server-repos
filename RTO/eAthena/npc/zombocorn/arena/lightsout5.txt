////////////////////////////////////////////////////////////////////////////////////////////////////
//  Lightsout!  ////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////
//=========== Written by =========================================================================//
// Dubby                                                                                          //
//=========== Compatible with ====================================================================//
// Tested with SVN 2555 Version                                                                   //
//                                                                                                //
//=========== Description ========================================================================//
// Remember an old school game called Lights Out?  Well this is an RO poring version.             //
//                                                                                                //
//=========== Comments ===========================================================================//
// The following are mapflags that are stamped on the lightsout5 map :                        //
// nomemo, nowarp, nowarpto, nobranch, noicewall, noteleport, nosave, noreturn, pvp	off             //
// ["job_wiz" is lightsout5]                                                              //
//                                                                                                //
// This minigame includes a GM Control Panel to change the game settings and rewards.  Usable     //
// only by players with a GM level of 80 or higher.  I don't want to change this.  If you want    //
// then you'll need to add a GM 99 settable variable, or change the number manually.  :D          //
//                                                                                                //
// You'll find the entrance NPC in prontera, in the center of town.  Since I'm not going to       //
// publicly release my arena anytime soon, I'll start dumping my npcs in pron for convienence.    //
//                                                                                                //
////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

lightsout5	mapflag	nosave	SavePoint
lightsout5	mapflag	noreturn
lightsout5	mapflag	pvp	off
lightsout5	mapflag	nomemo
lightsout5	mapflag	nobranch
lightsout5	mapflag	noteleport
lightsout5	mapflag	nowarp
lightsout5	mapflag	nowarpto

//This is the Room Controller npc, she houses the dialogue, activation script, and timer.
lightsout5,42,177,5	script	lightsout5	770,{
		if ($@LO5Ready == 1) goto M_NotReady;
	M_Menu:
		if ($@LO5On == 1) goto M_Menu2;
		mes "[Room Controller]";
		mes "Hello "+strcharinfo(0)+", welcome to Lightsout!  This is room 1.";
		next;
		if (getgmlevel() == 0) menu "Information",M_Info,"Start Game",-,"Leave Room",M_Exit;
		if (getgmlevel() > 79) menu "Information",M_Info,"Start Game",-,"Control Panel",M_Control,"Leave Room",M_Exit;
	M_Start:
		next;
		mes "[Room Controller]";
		mes "Alright, the room will activate shortly!  The board will begin randomized!";
		close2;
		set $@LO5On,1;
		goto L_Timer;
	M_Menu2:
		if ($@LO5CD == 1) end;
		mes "[Room Controller]";
		mes "The game is in progress.  What would you like to do?";
		mes " ";
		mes " ";
		set $@LO5MNTM,(((getnpctimer(0,"lightsout5") / 2000) / 60) %60);
		set $@LO5SETM,((getnpctimer(0,"lightsout5") / 2000) % 60);
		if ($@LO5SETM == 0 ) goto M_NewMin1;
		if ($@LO5SETM >= 51 ) goto M_Addzero1;
		mes "[Time remaining: " + (19-$@LO5MNTM) + ":" + (60-$@LO5SETM) + "]";
		goto M_Menu2a;
	M_NewMin1:
		mes "[Time remaining: " + (20-$@LO5MNTM) + ":00]";
		goto M_Menu2a;
	M_Addzero1:
		mes "[Time remaining: " + (19-$@LO5MNTM) + ":0" + (60-$@LO5SETM) + "]";
		goto M_Menu2a;
	M_Menu2a:
		next;
		if (getgmlevel() == 0) menu "Cancel",-,"Information and Rules",M_Info,"Leave Room",M_Warpout;
		if (getgmlevel() > 79) menu "Cancel",-,"Information and Rules",M_Info,"Control Panel",M_Control,"Leave Room",M_Warpout;
		close;
	M_Info:
		mes "[Room Controller]";
		if ($LO5Board == 0) mes "This game is very simple.  There are 49 porings that will appear in a 7x7 grid.  They can be either red, or green.";
		if ($LO5Board == 1) mes "This game is very simple.  There are 25 porings that will appear in a 5x5 grid.  They can be either red, or green.";
		next;
		mes "[Room Controller]";
		mes "Click on one, and their color will change, and so will the colors of the ones west, north, east, and south of it.";
		next;
		mes "[Room Controller]";
		mes "The objective is to make all the porings red, or OFF.  Do this, and you win the game and can cash in!  But if you make the entire board green, or ON... it's game over for you!";
		next;
		mes "[Room Controller]";
		mes "Each time you click on a poring, you will get one point added to your score.  The more points you have, the bigger your prize when you cash in.";
		next;
		mes "[Room Controller]";
		mes "But don't be click hastey!  The more points you have, the more likely another poring elsewhere on the board will randomize!  So be careful!";
		next;
		mes "[Room Controller]";
		mes "The game has a timelimit as well.  Twenty minutes.  If everyone here cannot solve the puzzle within twenty minutes, the board resets and nobody wins.";
		next;
		mes "[Room Controller]";
		mes "This is also a minigame you can play by yourself.  And that's about it!";
		next;
		mes "[Room Controller]";
		mes "What would you like to do?";
		next;
		goto M_Menu;
	M_Wait:
		mes "[Room Controller]";
		mes "Alright.";
		close;
	M_Warpout:
		mes "[Room Controller]";
		mes "The game is in progress, are you sure you want to leave?";
		next;
		menu "No, I'll stay",M_Wait,"Yes.",M_Exit;
	M_Exit:
		mes "[Room Controller]";
		mes "Please enjoy your stay in the Arena!";
		if (@LOpt > 0) set @LOpt,0;
		if (@LOBonus > 0) set @LOBonus,0;
		close2;
	warp "pvp_m_room", 51, 38;
		end;
	M_NotReady:
		mes "[Room Controller]";
		mes "Hello "+strcharinfo(0)+", this room has ended and is in a cooldown phase.  The room will be open again in a short while.";
		mes " ";
		set $@LO5MNTM,(((getnpctimer(0,"lightsout5") / 2000) / 60) %60);
		set $@LO5SETM,((getnpctimer(0,"lightsout5") / 2000) % 60);
		if ($@LO5SETM == 0 ) goto M_NewMin2;
		if ($@LO5SETM >= 51 ) goto M_Addzero2;
		mes "[Time remaining: " + (4-$@LO5MNTM) + ":" + (60-$@LO5SETM) + "]"; // Counts down, this is the base timer
		goto M_NotReady2;
	M_NewMin2:
		mes "[Time remaining: " + (5-$@LO5MNTM) + ":00]"; // Keeps the second from starting at 60
		goto M_NotReady2;
	M_Addzero2:
		mes "[Time remaining: " + (4-$@LO5MNTM) + ":0" + (60-$@LO5SETM) + "]"; // Adds a 0 infront of 1-9
		goto M_NotReady2;
	M_NotReady2:
		next;
		if ($@LO5LOSE == 1) goto M_NotReady4;
		if (@LOpt > 0) goto M_NotReady3;
	M_NotReady4:
		if (getgmlevel() > 79) menu "Wait in room.",M_Wait,"Control Panel",M_Control,"Leave Room",M_Exit;
		if (getgmlevel() < 80) menu "Wait in room.",M_Wait,"Leave Room",M_Exit;
	M_NotReady3:
		if (getgmlevel() > 79) menu "Wait in room.",M_Wait,"Control Panel",M_Control,"Cash in",M_Cashin;
		if (getgmlevel() < 80) menu "Wait in room.",M_Wait,"Cash in",M_Cashin;
	M_Cashin:
		mes "[Room Controller]";
		mes "Alright.... lets see how you did.";
		mes " ";
		mes " ";
		if (@LOBonus == 0) mes " ";
		mes "Total Points : "+@LOpt;
		if (@LOBonus == 1) mes "Plus Bonus!!";
		if ($LO5RewType == 0) mes "Kafra Points Earned : "+((@LOpt/$LO5Reward)*(@LOBonus+1)*(@LOBonus+1))+" KP";
		if ($LO5RewType == 1) mes "Zeny Earned : "+(((@LOpt/$LO5Reward)*50)*(@LOBonus+1)*(@LOBonus+1))+"z";

		next;
		mes "[Room Controller]";
		mes "Thank you for playing.";
		if ($LO5RewType == 0) set RESRVPTS,RESRVPTS + ((@LOpt/$LO5Reward)*(@LOBonus+1)*(@LOBonus+1));
		if ($LO5RewType == 1) set Zeny,Zeny + (((@LOpt/$LO5Reward)*50)*(@LOBonus+1)*(@LOBonus+1));
		if ($LO5RewType == 0) dispbottom "[You have "+RESRVPTS+" Kafra Reserve Points]";
		set @LOpt,0;
		if (@LOBonus > 0) set @LOBonus,0;
		next;
		mes "[Room Controller]";
		mes "Do you wish to stay here and wait for the room to become available, or return to the station?";
		next;
		menu "Wait in room.",M_Wait,"Leave Room",M_Exit;
	L_Timer:
		set $@LO5CD,1;
		setnpctimer 0; //safeguard
		StartNPCTimer "lightsout5";
		set $@LO5On,1;
		set $@LO5Title$,"- Game in Progress";
		mapannounce "lightsout5",strcharinfo(0) + " has started the countdown!  You have a 20 minute time limit!  The finishing player gains a bonus!",1;
		set $@LO5Count,1;
		end;
	OnTimer1000:
		if ($@LO5Count == 0) end;
		mapannounce "lightsout5","[10]",1;
		end;
	OnTimer2000:
		if ($@LO5Count == 0) end;
		mapannounce "lightsout5","[9]",1;
		end;
	OnTimer3000:
		if ($@LO5Count == 0) end;
		mapannounce "lightsout5","[8]",1;
		end;
	OnTimer4000:
		if ($@LO5Count == 0) end;
		mapannounce "lightsout5","[7]",1;
		end;
	OnTimer5000:
		if ($@LO5Ready == 1 && $@LO5LOSE == 0) mapannounce "lightsout5","The game is over, please redeem your earned points by talking to the Room Controller.",1;
		if ($@LO5Count == 0) end;
		mapannounce "lightsout5","[6]",1;
		end;
	OnTimer6000:
		if ($@LO5Count == 0) end;
		mapannounce "lightsout5","[5]",1;
		end;
	OnTimer7000:
		if ($@LO5Count == 0) end;
		mapannounce "lightsout5","[4]",1;
		end;
	OnTimer8000:
		if ($@LO5Count == 0) end;
		mapannounce "lightsout5","[3]",1;
		end;
	OnTimer9000:
		if ($@LO5Count == 0) end;
		mapannounce "lightsout5","[2]",1;
		end;
	OnTimer10000:
		if ($@LO5Count == 0) end;
		mapannounce "lightsout5","[1]",1;
		end;
	OnTimer11000:
		if ($@LO5Count == 0) end;
		emotion 27;
		specialeffect 267;
		specialeffect 267;
		specialeffect 267;
		specialeffect 267;
		specialeffect 267;
		mapannounce "lightsout5","[GO!]",1;
		set $@LO5CD,0;
		set $@LO5Count,0;
		setnpctimer 0;
		if ($LO5Board == 1) setarray $@LO5[0],0,0,0,0,0,0,0,0,0,9,10,11,12,13,0,0,16,17,18,19,20,0,0,23,24,25,26,27,0,0,30,31,32,33,34,0,0,37,38,39,40,41,0,0,0,0,0,0,0,0;
		if ($LO5Board == 0) setarray $@LO5[0],0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49;
		goto L_TurnOn;
	OnTimer30000:
		if ($@LO5Ready == 1 && $@LO5LOSE == 0) mapannounce "lightsout5","Please redeem your points with the Room Controller, you will be returned to the station automatically in ninety seconds.",1;
		end;
	OnTimer60000:
		if ($LO5AutoRst == 0 && getmapusers("lightsout5") == 0) goto L_GMReset;
		if ($@LO5Ready == 0) mapannounce "lightsout5","Nineteen minutes remaining.",1;
		if ($@LO5Ready == 1 && $@LO5LOSE == 0) mapannounce "lightsout5","Please redeem your points with the Room Controller, you will be returned to the station automatically in one minute.",1;
		if ($@LO5LOSE == 1) mapannounce "lightsout5","The game is over, you will be returned to the station automatically in one minute.",1;
		end;
	OnTimer90000:
		if ($@LO5Ready == 1 && $@LO5LOSE == 0) mapannounce "lightsout5","Please redeem your points with the Room Controller, you will be returned to the station automatically in thirty seconds.",1;
		if ($@LO5LOSE == 1) mapannounce "lightsout5","You will be returned to the station automatically in thirty seconds.",1;
		end;
	OnTimer100000:
		if ($@LO5Ready == 1 && $@LO5LOSE == 0) mapannounce "lightsout5","Please redeem your points with the Room Controller, you will be returned to the station automatically in twenty seconds.",1;
		if ($@LO5LOSE == 1) mapannounce "lightsout5","You will be returned to the station automatically in twenty seconds!",1;
		end;
	OnTimer110000:
		if ($@LO5Ready == 1 && $@LO5LOSE == 0) mapannounce "lightsout5","Please redeem your points with the Room Controller, you will be returned to the station automatically in ten seconds!",1;
		if ($@LO5LOSE == 1) mapannounce "lightsout5","You will be returned to the station automatically in ten seconds!",1;
		end;
	OnTimer115000:
		if ($@LO5Ready == 1 && $@LO5LOSE == 0) mapannounce "lightsout5","Please redeem your points with the Room Controller, you will be returned to the station automatically in five seconds!.",1;
		if ($@LO5LOSE == 1) mapannounce "lightsout5","You will be returned to the station automatically in five seconds!",1;
		end;
	OnTimer116000:
		if ($@LO5Ready == 1) mapannounce "lightsout5","Four!",1;
		end;
	OnTimer117000:
		if ($@LO5Ready == 1) mapannounce "lightsout5","Three!",1;
		end;
	OnTimer118000:
		if ($@LO5Ready == 1) mapannounce "lightsout5","Two!",1;
		end;
	OnTimer119000:
		if ($@LO5Ready == 1) mapannounce "lightsout5","One!!",1;
		end;
	OnTimer120000:
		if ($LO5AutoRst == 0 && getmapusers("lightsout5") == 0) goto L_GMReset;
		if ($@LO5Ready == 1) goto L_ResetPC;
		mapannounce "lightsout5","Eighteen minutes remaining.",1;
		end;
	OnTimer180000:
		if ($LO5AutoRst == 0 && getmapusers("lightsout5") == 0) goto L_GMReset;
		if ($@LO5Ready == 0) mapannounce "lightsout5","Seventeen minutes remaining.",1;
		end;
	OnTimer240000:
		if ($LO5AutoRst == 0 && getmapusers("lightsout5") == 0) goto L_GMReset;
		if ($@LO5Ready == 0) mapannounce "lightsout5","Sixteen minutes remaining.",1;
		end;
	OnTimer300000:
		if ($LO5AutoRst == 0 && getmapusers("lightsout5") == 0) goto L_GMReset;
		if ($@LO5Ready == 1) goto L_Reset;
		mapannounce "lightsout5","Fifteen minutes remaining.",1;
		end;
	OnTimer360000:
		if ($LO5AutoRst == 0 && getmapusers("lightsout5") == 0) goto L_GMReset;
		mapannounce "lightsout5","Fourteen minutes remaining.",1;
		end;
	OnTimer420000:
		if ($LO5AutoRst == 0 && getmapusers("lightsout5") == 0) goto L_GMReset;
		mapannounce "lightsout5","Thirteen minutes remaining.",1;
		end;
	OnTimer480000:
		if ($LO5AutoRst == 0 && getmapusers("lightsout5") == 0) goto L_GMReset;
		mapannounce "lightsout5","Twelve minutes remaining.",1;
		end;
	OnTimer540000:
		if ($LO5AutoRst == 0 && getmapusers("lightsout5") == 0) goto L_GMReset;
		mapannounce "lightsout5","Eleven minutes remaining.",1;
		end;
	OnTimer600000:
		if ($LO5AutoRst == 0 && getmapusers("lightsout5") == 0) goto L_GMReset;
		mapannounce "lightsout5","Ten minutes remaining.",1;
		end;
	OnTimer660000:
		if ($LO5AutoRst == 0 && getmapusers("lightsout5") == 0) goto L_GMReset;
		mapannounce "lightsout5","Nine minutes remaining.",1;
		end;
	OnTimer720000:
		if ($LO5AutoRst == 0 && getmapusers("lightsout5") == 0) goto L_GMReset;
		mapannounce "lightsout5","Eight minutes remaining.",1;
		end;
	OnTimer780000:
		if ($LO5AutoRst == 0 && getmapusers("lightsout5") == 0) goto L_GMReset;
		mapannounce "lightsout5","Seven minutes remaining.",1;
		end;
	OnTimer840000:
		if ($LO5AutoRst == 0 && getmapusers("lightsout5") == 0) goto L_GMReset;
		mapannounce "lightsout5","Six minutes remaining.",1;
		end;
	OnTimer900000:
		if ($LO5AutoRst == 0 && getmapusers("lightsout5") == 0) goto L_GMReset;
		mapannounce "lightsout5","Five minutes remaining.",1;
		end;
	OnTimer960000:
		if ($LO5AutoRst == 0 && getmapusers("lightsout5") == 0) goto L_GMReset;
		mapannounce "lightsout5","Four minutes remaining.",1;
		end;
	OnTimer1020000:
		if ($LO5AutoRst == 0 && getmapusers("lightsout5") == 0) goto L_GMReset;
		mapannounce "lightsout5","Three minutes remaining.",1;
		end;
	OnTimer1080000:
		if ($LO5AutoRst == 0 && getmapusers("lightsout5") == 0) goto L_GMReset;
		mapannounce "lightsout5","Two minutes remaining.",1;
		end;
	OnTimer1140000:
		if ($LO5AutoRst == 0 && getmapusers("lightsout5") == 0) goto L_GMReset;
		mapannounce "lightsout5","One minute remaining.",1;
		end;
	OnTimer1170000:
		mapannounce "lightsout5","Thirty seconds remaining.",1;
		end;
	OnTimer1180000:
		mapannounce "lightsout5","Twenty seconds remaining.",1;
		end;
	OnTimer1190000:
		mapannounce "lightsout5","Ten seconds remaining.",1;
		end;
	OnTimer1195000:
		mapannounce "lightsout5","Five!",1;
		end;
	OnTimer1196000:
		mapannounce "lightsout5","Four!",1;
		end;
	OnTimer1197000:
		mapannounce "lightsout5","Three!!",1;
		end;
	OnTimer1198000:
		mapannounce "lightsout5","Two!!",1;
		end;
	OnTimer1199000:
		mapannounce "lightsout5","One!!!",1;
		end;
	OnTimer1200000:
		if ($LO5AutoRst == 0 && getmapusers("lightsout5") == 0) goto L_GMReset;
		mapannounce "lightsout5","You have FAILED!!  Twenty minutes have elapsed and the game is over, the room will be able to start another game in 5 minutes.  You will be returned to the station automatically in two minutes.",1;
		set $@LO5Ready,1;
		set $@LO5LOSE,1;
		setnpctimer 0;
		goto L_TurnOff;
	L_ResetPC:
		set $@LO5On,0;
		set $@LO5LOSE,0;
		set $@LO5Title$,"- Room in Cooldown";
		mapannounce "lightsout5","Thank you for playing.",1;
		areawarp "lightsout5",1,1,400,400,"pvp_m_room",51,38;
		end;
	L_Reset:
		set $@LO5Ready,0;
		set $@LO5Title$,"";
		StopNPCTimer "lightsout5";
		setnpctimer 0;
		mapannounce "lightsout5","This room is now ready to start a game.",1;
		end;
	L_GMReset:
		set $@LO5On,0;
		set $@LO5LOSE,0;
		set $@LO5Ready,0;
		set $@LO5Title$,"";
		StopNPCTimer "lightsout5";
		setnpctimer 0;
		areawarp "lightsout5",1,1,400,400,"pvp_m_room",51,38;
		goto L_TurnOff;
	L_TurnOn:
		if ($@LO5CYCLE == 49) goto L_Activate1;
		set $@LO5CYCLE,$@LO5CYCLE + 1;
		if ($LO5Board == 1 && (($@LO5CYCLE >= 1 && $@LO5CYCLE < 9) || $@LO5CYCLE == 14 || $@LO5CYCLE == 15 || $@LO5CYCLE == 21 || $@LO5CYCLE == 22 || $@LO5CYCLE == 28 || $@LO5CYCLE == 29 || $@LO5CYCLE == 35 || $@LO5CYCLE == 36 || $@LO5CYCLE > 41)) goto L_TurnOn;
		enablenpc "light5_"+$@LO5CYCLE+"";
		goto L_TurnOn;
	L_Activate1:
		set $@LO5CYCLE,0;
	L_Activate:
		if ($@LO5CYCLE == 49) goto L_Randomize1;
		set $@LO5CYCLE,$@LO5CYCLE + 1;
		if ($LO5Board == 1 && (($@LO5CYCLE >= 1 && $@LO5CYCLE < 9) || $@LO5CYCLE == 14 || $@LO5CYCLE == 15 || $@LO5CYCLE == 21 || $@LO5CYCLE == 22 || $@LO5CYCLE == 28 || $@LO5CYCLE == 29 || $@LO5CYCLE == 35 || $@LO5CYCLE == 36 || $@LO5CYCLE > 41)) goto L_Activate;
		setnpcdisplay "light5_"+$@LO5CYCLE,"Off",1002;
		donpcevent "light5_"+$@LO5CYCLE+"::OnFlip";
		goto L_Activate;
	L_Randomize1:
		set $@LO5CYCLE,0;
	L_Rand:
		if ($@LO5CYCLE >= $LO5Random) goto L_End1;
		set $@LO5Rand,rand(1,49);
		if ($LO5Board == 1 && (($@LO5Rand >= 1 && $@LO5Rand < 9) || $@LO5Rand == 14 || $@LO5Rand == 15 || $@LO5Rand == 21 || $@LO5Rand == 22 || $@LO5Rand == 28 || $@LO5Rand == 29 || $@LO5Rand == 35 || $@LO5Rand == 36 || $@LO5Rand > 41)) goto L_Rand;
		if ($@LO5_0 == 0 && $@LO5[$@LO5Rand] < 50) goto sL_Randa;
		if ($@LO5_0 == 0 && $@LO5[$@LO5Rand] > 49) goto sL_Randb;
		set $@LO5_0,0;
		goto L_Rand;
	sL_Randa:
		set $@LO5[$@LO5Rand],($@LO5[$@LO5Rand] + 49);
		setnpcdisplay "light5_"+$@LO5Rand,"On",1031;
		donpcevent "light5_"+$@LO5Rand+"::OnFlip";
		set $@LO5CYCLE,$@LO5CYCLE + 1;
//CYCLECHECK	debugmes "[Lightsout Cyclecount : "+$@LO5CYCLE+"]";
		set $@LO5_0,1;
		goto L_Rand;
	sL_Randb:
		set $@LO5[$@LO5Rand],($@LO5[$@LO5Rand] - 49);
		setnpcdisplay "light5_"+$@LO5Rand,"Off",1002;
		donpcevent "light5_"+$@LO5Rand+"::OnFlip";
		set $@LO5CYCLE,$@LO5CYCLE + 1;
//CYCLECHECK	debugmes "[Lightsout Cyclecount : "+$@LO5CYCLE+"]";
		set $@LO5_0,1;
		goto L_Rand;
	L_TurnOff:
		cleararray $@LO5[1],0,49;
	L_TurnOff1:
		if ($@LO5CYCLE == 49) goto L_End;
		set $@LO5CYCLE,$@LO5CYCLE + 1;
		donpcevent "light5_"+$@LO5CYCLE+"::OnEnd";
		goto L_TurnOff1;
	L_End1:
		npctalk "-";
		npctalk "--";
		npctalk "---";
		npctalk "----";
		npctalk "-----";
		npctalk "You have 20 Minutes!  The person who flips the winning light wins a bonus!";
		set $@LO5Rand1,0;
	L_End:
		set $@LO5CYCLE,0;
		end;
//These is the GM control panel. GM Level 80+ required to access the panel.
M_Control:
	next;
	mes "[Room Controller]";
	mes "What would you like to do?";
	next;
	if ($LO5NT == 0 && $@LO5On == 1 || $LO5NT == 0 && $@LO5On == 1) menu "Change Auto Reset",M_AutoReset,"Change Board",M_Board,"Change Difficulty",M_Diff,"Change Reward",M_Reward,"Bring back Lightsout!",M_DingDong,"Reset Room",M_RmReset,"Return to Menu",M_Menu;
	if ($LO5NT == 1 && $@LO5On == 1 || $LO5NT == 1 && $@LO5On == 1) menu "Change Auto Reset",M_AutoReset,"Change Board",M_Board,"Change Difficulty",M_Diff,"Change Reward",M_Reward,"No more Lightsout!",M_DingDong2,"Reset Room",M_RmReset,"Return to Menu",M_Menu;
	if ($LO5NT == 0 && $@LO5LOSE == 1 || $LO5NT == 0 && $@LO5Ready == 1) menu "Change Auto Reset",M_AutoReset,"Change Board",M_Board,"Change Difficulty",M_Diff,"Change Reward",M_Reward,"Bring back Lightsout!",M_DingDong,"Reset Room",M_RmReset,"Return to Menu",M_Menu;
	if ($LO5NT == 1 && $@LO5LOSE == 1 || $LO5NT == 1 && $@LO5Ready == 1) menu "Change Auto Reset",M_AutoReset,"Change Board",M_Board,"Change Difficulty",M_Diff,"Change Reward",M_Reward,"No more Lightsout!",M_DingDong2,"Reset Room",M_RmReset,"Return to Menu",M_Menu;
	if ($LO5NT == 0) menu "Change Auto Reset",M_AutoReset,"Change Board",M_Board,"Change Difficulty",M_Diff,"Change Reward",M_Reward,"Bring back Lightsout!",M_DingDong,"Return to Menu",M_Menu;
	if ($LO5NT == 1) menu "Change Auto Reset",M_AutoReset,"Change Board",M_Board,"Change Difficulty",M_Diff,"Change Reward",M_Reward,"No more Lightsout!",M_DingDong2,"Return to Menu",M_Menu;
M_AutoReset:
	mes "[Room Controller]";
	if ($LO5AutoRst == 0) mes "The room is set to automatically reset if the room is empty.  The room checks this once every minute while the timer is active.  Do you wish to turn this feature off?";
	if ($LO5AutoRst == 1) mes "The room is set to wait the full 20 minutes before reseting, even if the room is empty.  Do you wish to turn the automatic reset feature on?";
	next;
	if ($LO5AutoRst == 0) menu "Yes",M_AutOff,"No",M_Control;
	if ($LO5AutoRst == 1) menu "Yes",-,"No",M_Control;
	set $LO5AutoRst,0;
	goto M_Control;
M_AutOff:
	set $LO5AutoRst,1;
	goto M_Control;
M_Board:
	mes "[Room Controller]";
	if ($LO5Board == 1) mes "The board is currently a 5x5 grid.  Would you like to change it to a 7x7 grid?  (Initial Randomization setting will also be changed to 1)";
	if ($LO5Board == 0) mes "The board is currently a 7x7 grid.  Would you like to change it to a 5x5 grid?  (Initial Randomization setting will also be changed to 1)";
	next;
	if ($LO5Board == 1) menu "Yes",M_7x7,"No",M_Control;
	if ($LO5Board == 0) menu "Yes",-,"No",M_Control;
	set $LO5Board,1;
	set $LO5Random,1;
	goto M_Control;
M_7x7:
	set $LO5Board,0;
	set $LO5Random,1;
	goto M_Control;
M_Diff:
	mes "[Room Controller]";
	mes "There are two ways to change the difficulty of the room.";
	next;
	mes "[Room Controller]";
	mes "You may change the intial randomization amount, or you may change point based randomization, or turn point based randomization off.";
	next;
	menu "Change Initial Rand",-,"Change Point Based Rand",M_RandPoint,"Return",M_Control;
	mes "[Room Controller]";
	if ($LO5Board == 0) mes "This number controls how many times the lights are randomized when the game begins.  The number must be atleast 1 and cannot be 49 or higher.";
	if ($LO5Board == 1) mes "This number controls how many times the lights are randomized when the game begins.  The number must be atleast 1 and cannot be 25 or higher.";
	mes "Current Setting is ["+$LO5Random+"]";
	next;
M_RInRepeat:
	input $LO5Random;
	next;
	if ($LO5Board == 0 && ($LO5Random >= 49 || $LO5Random < 1)) goto M_RInError;
	if ($LO5Board == 1 && ($LO5Random >= 25 || $LO5Random < 1)) goto M_RInError;
M_Diff2:
	mes "[Room Controller]";
	mes "Thank you.  The porings will now randomize "+$LO5Random+" times at the start of the game.";
	next;
	goto M_Control;
M_RInError:
	mes "[Room Controller]";
	if ($LO5Board == 0) mes "The number must be atleast 1 and cannot be 49 or higher!";
	if ($LO5Board == 1) mes "The number must be atleast 1 and cannot be 25 or higher!";
	next;
	goto M_RInRepeat;
M_RandPoint:
	mes "[Room Controller]";
	mes "Point randomization works like this.  After the player has collected, say, 50 points, there is a 1 in 100 chance that another poring on the board will flip on/off.";
	next;
	mes "[Room Controller]";
	mes "There are five 'Levels' of this, this is the equation, where [var] is the number you input.  Each rand has a 1 in <total> chance of happening.  The variable is used to determine the limitations.  Recommended value is 5-10.";
	next;
	mes "[Room Controller]";
	mes "[Pts > [Var] & 1/60]";
	mes "[Pts > [Var]*2 & 1/50]";
	mes "[Pts > [Var]*5 & 1/40]";
	mes "[Pts > [Var]*10 & 1/30]";
	mes "[Pts > [Var]*16 & 1/20]";
	next;
	mes "[Room Controller]";
	mes "Please set the variable.  You may not set the variable below 5.  Set the variable to 0 to turn this option off.";
	if ($LO5Var > 0) mes "Current Setting is ["+$LO5Var+"]";
	if ($LO5Var == 0) mes "Current setting is [OFF]";
	next;
M_RandPIn:
	input $LO5Var;
	next;
	if ($LO5Var == 0) goto M_RandPoint2;
	if ($LO5Var < 5) goto M_RandPError;
M_RandPoint2:
	mes "[Room Controller]";
	if ($LO5Var > 0) mes "The variable has been changed to "+$LO5Var+".";
	if ($LO5Var == 0) mes "Randomization of lights based on points is now off.";
	next;
	goto M_Control;
M_RandPError:
	mes "[Room Controller]";
	mes "You cannot set the variable below 25.";
	next;
	goto M_RandPIn;
M_Reward:
	mes "[Room Controller]";
	mes "How would you like to setup the reward?";
	next;
	menu "Change Modifier",-,"Change Type",M_RewType,"Return",M_Control;
	mes "[Room Controller]";
	mes "This modifier controls how the player's points are divided when they complete the game.";
	next;
	mes "[Room Controller]";
	mes "The player's points is divided by this modifier.  If the reward type is set to zeny, then a multiplier is added to the equation to give reasonable amounts of zeny.";
	next;
	mes "[Room Controller]";
	mes "The variable cannot be 0, and cannot be more then 10.";
	mes "Current Setting is ["+$LO5Reward+"]";
M_RewReSelect:
	next;
	input $LO5Reward;
	next;
	if ($LO5Reward == 0 || $LO5Reward > 10) goto M_RewInError;
	mes "[Room Controller]";
	mes "The reward modifier has been set to "+$LO5Reward+".";
	goto M_Control;
M_RewInError:
	mes "[Room Controller]";
	mes "Invalid modifier was selected. The modifier cannot be less than or equal to 0, or greater than 10.";
	set $LO5Reward,1;
	goto M_RewReSelect;
M_RewType:
	mes "[Room Controller]";	
	mes "Do you want the players do receive a KP (Kafra Point) reward, or a Zeny reward?";
	if ($LO5RewType == 1) mes "[Reward currently set to Zeny]";
	if ($LO5RewType == 0) mes "[Reward currently set to Kafra Points]";
	next;
	menu "Zeny",-,"Kafra Point",M_RewKP;
	set $LO5RewType,1;
M_RewInf:
	mes "[Room Controller]";
	if ($LO5RewType == 1) mes "Thank you, the reward is now set to Zeny.";
	if ($LO5RewType == 0) mes "Thank you, the reward is now set to Kafra Points.";
	goto M_Control;
M_RewKP:
	set $LO5RewType,0;
	goto M_RewInf;
M_DingDong:
	next;
	set $LO5NT,1;
	mes "[Room Controller]";
	mes "The Lightsout is back!";
	goto M_Control;
M_DingDong2:
	next;
	set $LO5NT,0;
	mes "[Room Controller]";
	mes "No more Lightsout...";
	goto M_Control;
M_RmReset:
	mes "[Room Controller]";
	mes "Resetting room...";
	next;
	goto L_GMReset;
//These default important settings on a first install, do not touch.
OnInit:
	setnpcdisplay "lightsout5","Room Controller",770;
	if ($LO5Random == 0 && $LO5Var == 0) set $LO5Var,50;
	if ($LO5Random == 0) set $LO5Random,11;
	if ($LO5Reward == 0) set $LO5Reward,2;
	L_Disable:
		disablenpc "light5_"+$@LO5CYCLE+"";
		if ($@LO5CYCLE == 49) goto L_DisEnd;
		set $@LO5CYCLE,$@LO5CYCLE + 1;
		goto L_Disable;
	L_DisEnd:
		set $@LO5CYCLE,0;
		end;
}

//This is the master function that powers the entire minigame.
//DO NOT touch this.
function	script	F_LO5LightFlip	{
	set $@LO5_0,0;
	set $@LO5_1,0;
	set $@LO5_2,0;
	set $@LO5_3,0;
	set $@LO5_4,0;
L_C:
	if ($@LO5_0 == 0 && getarg(0) != 0 && $@LO5[getarg(0)] < 50) goto sL_Ca;
	if ($@LO5_0 == 0 && getarg(0) != 0 && $@LO5[getarg(0)] > 49) goto sL_Cb;
	goto L_L;
sL_Ca:
	set $@LO5[getarg(0)],($@LO5[getarg(0)] + 49);
	setnpcdisplay "light5_"+getarg(0),"On",1031;
	set $@LO5_0,1;
	goto L_C;
sL_Cb:
	set $@LO5[getarg(0)],($@LO5[getarg(0)] - 49);
	setnpcdisplay "light5_"+getarg(0),"Off",1002;
	set $@LO5_0,1;
	goto L_C;
L_L:
	if ($@LO5_1 == 0 && getarg(1) != 0 && $@LO5[getarg(1)] < 50) goto sL_La;
	if ($@LO5_1 == 0 && getarg(1) != 0 && $@LO5[getarg(1)] > 49) goto sL_Lb;
	goto L_T;
sL_La:
	set $@LO5[getarg(1)],($@LO5[getarg(1)] + 49);
	setnpcdisplay "light5_"+getarg(1),"On",1031;
	set $@LO5_1,1;
	goto L_L;
sL_Lb:
	set $@LO5[getarg(1)],($@LO5[getarg(1)] - 49);
	setnpcdisplay "light5_"+getarg(1),"Off",1002;
	set $@LO5_1,1;
	goto L_L;
L_T:
	if ($@LO5_2 == 0 && getarg(2) != 0 && $@LO5[getarg(2)] < 50) goto sL_Ta;
	if ($@LO5_2 == 0 && getarg(2) != 0 && $@LO5[getarg(2)] > 49) goto sL_Tb;
	goto L_R;
sL_Ta:
	set $@LO5[getarg(2)],($@LO5[getarg(2)] + 49);
	setnpcdisplay "light5_"+getarg(2),"On",1031;
	set $@LO5_2,1;
	goto L_T;
sL_Tb:
	set $@LO5[getarg(2)],($@LO5[getarg(2)] - 49);
	setnpcdisplay "light5_"+getarg(2),"Off",1002;
	set $@LO5_2,1;
	goto L_T;
L_R:
	if ($@LO5_3 == 0 && getarg(3) != 0 && $@LO5[getarg(3)] < 50) goto sL_Ra;
	if ($@LO5_3 == 0 && getarg(3) != 0 && $@LO5[getarg(3)] > 49) goto sL_Rb;
	goto L_B;
sL_Ra:
	set $@LO5[getarg(3)],($@LO5[getarg(3)] + 49);
	setnpcdisplay "light5_"+getarg(3),"On",1031;
	set $@LO5_3,1;
	goto L_R;
sL_Rb:
	set $@LO5[getarg(3)],($@LO5[getarg(3)] - 49);
	setnpcdisplay "light5_"+getarg(3),"Off",1002;
	set $@LO5_3,1;
	goto L_R;
L_B:
	if ($@LO5_4 == 0 && getarg(4) != 0 && $@LO5[getarg(4)] < 50) goto sL_Ba;
	if ($@LO5_4 == 0 && getarg(4) != 0 && $@LO5[getarg(4)] > 49) goto sL_Bb;
	goto L_Engine;
sL_Ba:
	set $@LO5[getarg(4)],($@LO5[getarg(4)] + 49);
	setnpcdisplay "light5_"+getarg(4),"On",1031;
	set $@LO5_4,1;
	goto L_B;
sL_Bb:
	set $@LO5[getarg(4)],($@LO5[getarg(4)] - 49);
	setnpcdisplay "light5_"+getarg(4),"Off",1002;
	set $@LO5_4,1;
	goto L_B;
L_Engine:
	if (getarg(0) != 0) donpcevent "light5_"+getarg(0)+"::OnFlip";
	if (getarg(1) != 0) donpcevent "light5_"+getarg(1)+"::OnFlip";
	if (getarg(2) != 0) donpcevent "light5_"+getarg(2)+"::OnFlip";
	if (getarg(3) != 0) donpcevent "light5_"+getarg(3)+"::OnFlip";
	if (getarg(4) != 0) donpcevent "light5_"+getarg(4)+"::OnFlip";
	if (getarg(0) != 0 && (rand(1,4) == 4)) donpcevent "light5_"+getarg(0)+"::OnAni";
	if (getarg(1) != 0 && (rand(1,4) == 4)) donpcevent "light5_"+getarg(1)+"::OnAni";
	if (getarg(2) != 0 && (rand(1,4) == 4)) donpcevent "light5_"+getarg(2)+"::OnAni";
	if (getarg(3) != 0 && (rand(1,4) == 4)) donpcevent "light5_"+getarg(3)+"::OnAni";
	if (getarg(4) != 0 && (rand(1,4) == 4)) donpcevent "light5_"+getarg(4)+"::OnAni";
	if (rand(1,4) == 4) donpcevent "light5_"+(rand(1,49))+"::OnAni";
	if (rand(1,4) == 4) donpcevent "light5_"+(rand(1,49))+"::OnAni";
	if (rand(1,4) == 4) donpcevent "light5_"+(rand(1,49))+"::OnAni";
	if (rand(1,4) == 4) donpcevent "light5_"+(rand(1,49))+"::OnAni";
	set @LOpt,@LOpt + 1;
	set $@LO5_0,0;
	set $@LO5_1,0;
	set $@LO5_2,0;
	set $@LO5_3,0;
	set $@LO5_4,0;
	if ($LO5NT == 1 && $@LO5[getarg(0)] < 50) npctalk "Dong!";
	if ($LO5NT == 1 && $@LO5[getarg(0)] > 49) npctalk "Ding!";
if ($LO5Board == 1 && ($@LO5[1]+$@LO5[2]+$@LO5[3]+$@LO5[4]+$@LO5[5]+$@LO5[6]+$@LO5[7]+$@LO5[8]+
	$@LO5[9]+$@LO5[10]+$@LO5[11]+$@LO5[12]+$@LO5[13]+$@LO5[14]+$@LO5[15]+$@LO5[16]+
	$@LO5[17]+$@LO5[18]+$@LO5[19]+$@LO5[20]+$@LO5[21]+$@LO5[22]+$@LO5[23]+$@LO5[24]+
	$@LO5[25]+$@LO5[26]+$@LO5[27]+$@LO5[28]+$@LO5[29]+$@LO5[30]+$@LO5[31]+$@LO5[32]+
	$@LO5[33]+$@LO5[34]+$@LO5[35]+$@LO5[36]+$@LO5[37]+$@LO5[38]+$@LO5[39]+$@LO5[40]+
	$@LO5[41]+$@LO5[42]+$@LO5[43]+$@LO5[44]+$@LO5[45]+$@LO5[46]+$@LO5[47]+$@LO5[48]+
	$@LO5[49]) == 625) goto L_AllOff;
if ($LO5Board == 1 && ($@LO5[1]+$@LO5[2]+$@LO5[3]+$@LO5[4]+$@LO5[5]+$@LO5[6]+$@LO5[7]+$@LO5[8]+
	$@LO5[9]+$@LO5[10]+$@LO5[11]+$@LO5[12]+$@LO5[13]+$@LO5[14]+$@LO5[15]+$@LO5[16]+
	$@LO5[17]+$@LO5[18]+$@LO5[19]+$@LO5[20]+$@LO5[21]+$@LO5[22]+$@LO5[23]+$@LO5[24]+
	$@LO5[25]+$@LO5[26]+$@LO5[27]+$@LO5[28]+$@LO5[29]+$@LO5[30]+$@LO5[31]+$@LO5[32]+
	$@LO5[33]+$@LO5[34]+$@LO5[35]+$@LO5[36]+$@LO5[37]+$@LO5[38]+$@LO5[39]+$@LO5[40]+
	$@LO5[41]+$@LO5[42]+$@LO5[43]+$@LO5[44]+$@LO5[45]+$@LO5[46]+$@LO5[47]+$@LO5[48]+
	$@LO5[49]) == 1850) goto L_AllOn;
if ($LO5Board == 0 && ($@LO5[1]+$@LO5[2]+$@LO5[3]+$@LO5[4]+$@LO5[5]+$@LO5[6]+$@LO5[7]+$@LO5[8]+
	$@LO5[9]+$@LO5[10]+$@LO5[11]+$@LO5[12]+$@LO5[13]+$@LO5[14]+$@LO5[15]+$@LO5[16]+
	$@LO5[17]+$@LO5[18]+$@LO5[19]+$@LO5[20]+$@LO5[21]+$@LO5[22]+$@LO5[23]+$@LO5[24]+
	$@LO5[25]+$@LO5[26]+$@LO5[27]+$@LO5[28]+$@LO5[29]+$@LO5[30]+$@LO5[31]+$@LO5[32]+
	$@LO5[33]+$@LO5[34]+$@LO5[35]+$@LO5[36]+$@LO5[37]+$@LO5[38]+$@LO5[39]+$@LO5[40]+
	$@LO5[41]+$@LO5[42]+$@LO5[43]+$@LO5[44]+$@LO5[45]+$@LO5[46]+$@LO5[47]+$@LO5[48]+
	$@LO5[49]) == 1225) goto L_AllOff;
if ($LO5Board == 0 && ($@LO5[1]+$@LO5[2]+$@LO5[3]+$@LO5[4]+$@LO5[5]+$@LO5[6]+$@LO5[7]+$@LO5[8]+
	$@LO5[9]+$@LO5[10]+$@LO5[11]+$@LO5[12]+$@LO5[13]+$@LO5[14]+$@LO5[15]+$@LO5[16]+
	$@LO5[17]+$@LO5[18]+$@LO5[19]+$@LO5[20]+$@LO5[21]+$@LO5[22]+$@LO5[23]+$@LO5[24]+
	$@LO5[25]+$@LO5[26]+$@LO5[27]+$@LO5[28]+$@LO5[29]+$@LO5[30]+$@LO5[31]+$@LO5[32]+
	$@LO5[33]+$@LO5[34]+$@LO5[35]+$@LO5[36]+$@LO5[37]+$@LO5[38]+$@LO5[39]+$@LO5[40]+
	$@LO5[41]+$@LO5[42]+$@LO5[43]+$@LO5[44]+$@LO5[45]+$@LO5[46]+$@LO5[47]+$@LO5[48]+
	$@LO5[49]) == 3626) goto L_AllOn;
	if ($LO5Var > 0) goto L_PointRand;
	end;
L_PointRand:
	if (@LOpt > ($LO5Var*16) && rand(1,20) == 20) goto L_Randomize;
	if (@LOpt > ($LO5Var*10) && rand(1,30) == 30) goto L_Randomize;
	if (@LOpt > ($LO5Var*5) && rand(1,40) == 40) goto L_Randomize;
	if (@LOpt > ($LO5Var*2) && rand(1,50) == 50) goto L_Randomize;
	if (@LOpt > $LO5Var && rand(1,60) == 60) goto L_Randomize;
	end;
L_Randomize:
	set $@LO5Rand,rand(1,49);
	if ($LO5Board == 1 && (($@LO5Rand >= 1 && $@LO5Rand < 9) || $@LO5Rand == 14 || $@LO5Rand == 15 || $@LO5Rand == 21 || $@LO5Rand == 22 || $@LO5Rand == 28 || $@LO5Rand == 29 || $@LO5Rand == 35 || $@LO5Rand == 36 || $@LO5Rand > 41)) goto L_Randomize;
L_Rand:
	if ($@LO5_0 == 0 && $@LO5[$@LO5Rand] < 50) goto sL_Randa;
	if ($@LO5_0 == 0 && $@LO5[$@LO5Rand] > 49) goto sL_Randb;
	goto sL_Randc;
sL_Randa:
	set $@LO5[$@LO5Rand],($@LO5[$@LO5Rand] + 49);
	setnpcdisplay "light5_"+$@LO5Rand,"On",1031;
	donpcevent "light5_"+$@LO5Rand+"::OnFlip";
	set $@LO5_0,1;
	goto L_Rand;
sL_Randb:
	set $@LO5[$@LO5Rand],($@LO5[$@LO5Rand] - 49);
	setnpcdisplay "light5_"+$@LO5Rand,"Off",1002;
	donpcevent "light5_"+$@LO5Rand+"::OnFlip";
	set $@LO5_0,1;
	goto L_Rand;
sL_Randc:
	donpcevent "light5_"+$@LO5Rand+"::OnAni";
	set $@LO5Rand,0;
	set $@LO5_0,0;
	end;
L_AllOff:
	mapannounce "lightsout5","Victory!  Congratulations!",1;
	set @LOBonus,1;
L_LoseCycle:
	if ($@LO5CYCLE == 49) goto L_End;
	set $@LO5CYCLE,$@LO5CYCLE + 1;
	if ($LO5Board == 1 && (($@LO5CYCLE >= 1 && $@LO5CYCLE < 9) || $@LO5CYCLE == 14 || $@LO5CYCLE == 15 || $@LO5CYCLE == 21 || $@LO5CYCLE == 22 || $@LO5CYCLE == 28 || $@LO5CYCLE == 29 || $@LO5CYCLE == 35 || $@LO5CYCLE == 36 || $@LO5CYCLE > 41)) goto L_LoseCycle;
	donpcevent "light5_"+$@LO5CYCLE+"::OnEnd";
	goto L_LoseCycle;
	end;
L_AllOn:
	set $@LO5LOSE,1;
	mapannounce "lightsout5","Defeat!  Game over for you!",1;
L_WinCycle:
	if ($@LO5CYCLE == 49) goto L_End;
	set $@LO5CYCLE,$@LO5CYCLE + 1;
	if ($LO5Board == 1 && (($@LO5CYCLE >= 1 && $@LO5CYCLE < 9) || $@LO5CYCLE == 14 || $@LO5CYCLE == 15 || $@LO5CYCLE == 21 || $@LO5CYCLE == 22 || $@LO5CYCLE == 28 || $@LO5CYCLE == 29 || $@LO5CYCLE == 35 || $@LO5CYCLE == 36 || $@LO5CYCLE > 41)) goto L_WinCycle;
	donpcevent "light5_"+$@LO5CYCLE+"::OnEnd";
	goto L_WinCycle;
	end;
L_End:
	set $@LO5CYCLE,0;
	set $@LO5Ready,1;
	setnpctimer 0,"lightsout5";
	end;
}

//This function powers the endgame animation of the lights.
//This is called by each lights' "OnEnd" label
function	script	F_LO5LightEnd	{
	if ($@LO5LOSE == 1) goto L_GameOver;
	specialeffect 70;
	disablenpc "light5_"+getarg(0);
	end;
L_GameOver:
	specialeffect 183;
// these two are loud as hell but still look cool together
//	specialeffect 380;
//	specialeffect 409;
	disablenpc "light5_"+getarg(0);
	end;
}

//This function makes the lights do strange things randomly.  (this one is entirely for fun and amusement)
function	script	F_LO5LightAni	{
	set $@LO5Rand,rand(1,13);
// these two are the only ones that make noise, so i decided to turn them off.
//	if ($@LO5Rand == 1) specialeffect 363;
//	if ($@LO5Rand == 2) specialeffect 364;
	if ($@LO5Rand == 3) specialeffect 458;
	if ($@LO5Rand == 4) specialeffect 426;
	if ($@LO5Rand == 5) specialeffect 413;
	if ($@LO5Rand == 6) specialeffect 414;
	if ($@LO5Rand == 7) specialeffect 417;
	if ($@LO5Rand == 8) specialeffect 449;
	if ($@LO5Rand == 9) specialeffect 435;
	if ($@LO5Rand == 10) specialeffect 466;
	set $@LO5Rand,rand(1,13);
	if ($@LO5Rand == 1) emotion 0;
	if ($@LO5Rand == 2) emotion 1;
	if ($@LO5Rand == 3) emotion 3;
	if ($@LO5Rand == 4) emotion 4;
	if ($@LO5Rand == 5) emotion 7;
	if ($@LO5Rand == 6) emotion 19;
	if ($@LO5Rand == 7) emotion 18;
	if ($@LO5Rand == 8) emotion 23;
	if ($@LO5Rand == 9) emotion 26;
	if ($@LO5Rand == 10) emotion 28;
	if ($@LO5Rand == 11) emotion 40;
	if ($@LO5Rand == 12) emotion 39;
	if ($@LO5Rand == 13) emotion 45;
	set $@LO5Rand,0;
	end;
}
//guide to what the above effects are.
//  specialeffect ???;
//	363 = heart with wings
//	364 = heart no wings
//	458 = long jiggle
//	426 = short jiggle
//	413 = squat
//	414 = spin fast
//	415 = pounce
//	417 = blink white
//	449 = blink blue
//	435 = twirl slowly
//	466 = spin slowly
//  emotion ??;
//	0 = !
//	1 = ?
//	3 = heart 1
//	4 = sweat
//	7 = smoke cloud
//	19= sweating
//	18= laughing
//	23= omg!!
//	26= help!
//	28= sobbing
//	40= tsk tsk tsk
//	39= tongue
//	45= yawn

//This is a list of all 49 lights.
lightsout5,40,156,5	script	light5_1	139,{
	callfunc "F_LO5LightFlip",1,0,8,2,0;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",1;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,43,156,5	script	light5_2	139,{
	callfunc "F_LO5LightFlip",2,1,9,3,0;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",2;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,46,156,5	script	light5_3	139,{
	callfunc "F_LO5LightFlip",3,2,10,4,0;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",3;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,49,156,5	script	light5_4	139,{
	callfunc "F_LO5LightFlip",4,3,11,5,0;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",4;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,52,156,5	script	light5_5	139,{
	callfunc "F_LO5LightFlip",5,4,12,6,0;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",5;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,55,156,5	script	light5_6	139,{
	callfunc "F_LO5LightFlip",6,5,13,7,0;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",6;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,58,156,5	script	light5_7	139,{
	callfunc "F_LO5LightFlip",7,6,14,0,0;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",7;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,40,159,5	script	light5_8	139,{
	callfunc "F_LO5LightFlip",8,0,15,9,1;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",8;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,43,159,5	script	light5_9	139,{
	if ($LO5Board == 1) goto L_5x5;
	callfunc "F_LO5LightFlip",9,8,16,10,2;
	end;
L_5x5:
	callfunc "F_LO5LightFlip",9,0,16,10,0;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",9;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,46,159,5	script	light5_10	139,{
	if ($LO5Board == 1) goto L_5x5;
	callfunc "F_LO5LightFlip",10,9,17,11,3;
	end;
L_5x5:
	callfunc "F_LO5LightFlip",10,9,17,11,0;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",10;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,49,159,5	script	light5_11	139,{
	if ($LO5Board == 1) goto L_5x5;
	callfunc "F_LO5LightFlip",11,10,18,12,4;
	end;
L_5x5:
	callfunc "F_LO5LightFlip",11,10,18,12,0;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",11;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,52,159,5	script	light5_12	139,{
	if ($LO5Board == 1) goto L_5x5;
	callfunc "F_LO5LightFlip",12,11,19,13,5;
	end;
L_5x5:
	callfunc "F_LO5LightFlip",12,11,19,13,0;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",12;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,55,159,5	script	light5_13	139,{
	if ($LO5Board == 1) goto L_5x5;
	callfunc "F_LO5LightFlip",13,12,20,14,6;
	end;
L_5x5:
	callfunc "F_LO5LightFlip",13,12,20,0,0;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",13;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,58,159,5	script	light5_14	139,{
	callfunc "F_LO5LightFlip",14,13,21,0,7;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",14;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,40,162,5	script	light5_15	139,{
	callfunc "F_LO5LightFlip",15,0,22,16,8;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",15;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,43,162,5	script	light5_16	139,{
	if ($LO5Board == 1) goto L_5x5;
	callfunc "F_LO5LightFlip",16,15,23,17,9;
	end;
L_5x5:
	callfunc "F_LO5LightFlip",16,0,23,17,9;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",16;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,46,162,5	script	light5_17	139,{
	callfunc "F_LO5LightFlip",17,16,24,18,10;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",17;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,49,162,5	script	light5_18	139,{
	callfunc "F_LO5LightFlip",18,17,25,19,11;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",18;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,52,162,5	script	light5_19	139,{
	callfunc "F_LO5LightFlip",19,18,26,20,12;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",19;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,55,162,5	script	light5_20	139,{
	if ($LO5Board == 1) goto L_5x5;
	callfunc "F_LO5LightFlip",20,19,27,21,13;
	end;
L_5x5:
	callfunc "F_LO5LightFlip",20,19,27,0,13;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",20;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,58,162,5	script	light5_21	139,{
	callfunc "F_LO5LightFlip",21,20,28,0,14;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",21;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,40,165,5	script	light5_22	139,{
	callfunc "F_LO5LightFlip",22,0,29,23,15;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",22;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,43,165,5	script	light5_23	139,{
	if ($LO5Board == 1) goto L_5x5;
	callfunc "F_LO5LightFlip",23,22,30,24,16;
	end;
L_5x5:
	callfunc "F_LO5LightFlip",23,0,30,24,16;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",23;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,46,165,5	script	light5_24	139,{
	callfunc "F_LO5LightFlip",24,23,31,25,17;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",24;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,49,165,5	script	light5_25	139,{
	callfunc "F_LO5LightFlip",25,24,32,26,18;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",25;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,52,165,5	script	light5_26	139,{
	callfunc "F_LO5LightFlip",26,25,33,27,19;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",26;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,55,165,5	script	light5_27	139,{
	if ($LO5Board == 1) goto L_5x5;
	callfunc "F_LO5LightFlip",27,26,34,28,20;
	end;
L_5x5:
	callfunc "F_LO5LightFlip",27,26,34,0,20;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",27;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,58,165,5	script	light5_28	139,{
	callfunc "F_LO5LightFlip",28,27,35,0,21;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",28;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,40,168,5	script	light5_29	139,{
	callfunc "F_LO5LightFlip",29,0,36,30,22;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",29;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,43,168,5	script	light5_30	139,{
	if ($LO5Board == 1) goto L_5x5;
	callfunc "F_LO5LightFlip",30,29,37,31,23;
	end;
L_5x5:
	callfunc "F_LO5LightFlip",30,0,37,31,23;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",30;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,46,168,5	script	light5_31	139,{
	callfunc "F_LO5LightFlip",31,30,38,32,24;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",31;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,49,168,5	script	light5_32	139,{
	callfunc "F_LO5LightFlip",32,31,39,33,25;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",32;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,52,168,5	script	light5_33	139,{
	callfunc "F_LO5LightFlip",33,32,40,34,26;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",33;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,55,168,5	script	light5_34	139,{
	if ($LO5Board == 1) goto L_5x5;
	callfunc "F_LO5LightFlip",34,33,41,35,27;
	end;
L_5x5:
	callfunc "F_LO5LightFlip",34,33,41,0,27;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",34;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,58,168,5	script	light5_35	139,{
	callfunc "F_LO5LightFlip",35,34,42,0,28;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",35;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,40,171,5	script	light5_36	139,{
	callfunc "F_LO5LightFlip",36,0,43,37,29;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",36;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,43,171,5	script	light5_37	139,{
	if ($LO5Board == 1) goto L_5x5;
	callfunc "F_LO5LightFlip",37,36,44,38,30;
	end;
L_5x5:
	callfunc "F_LO5LightFlip",37,0,0,38,30;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",37;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,46,171,5	script	light5_38	139,{
	if ($LO5Board == 1) goto L_5x5;
	callfunc "F_LO5LightFlip",38,37,45,39,31;
	end;
L_5x5:
	callfunc "F_LO5LightFlip",38,37,0,39,31;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",38;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,49,171,5	script	light5_39	139,{
	if ($LO5Board == 1) goto L_5x5;
	callfunc "F_LO5LightFlip",39,38,46,40,32;
	end;
L_5x5:
	callfunc "F_LO5LightFlip",39,38,0,40,32;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",39;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,52,171,5	script	light5_40	139,{
	if ($LO5Board == 1) goto L_5x5;
	callfunc "F_LO5LightFlip",40,39,47,41,33;
	end;
L_5x5:
	callfunc "F_LO5LightFlip",40,39,0,41,33;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",40;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,55,171,5	script	light5_41	139,{
	if ($LO5Board == 1) goto L_5x5;
	callfunc "F_LO5LightFlip",41,40,48,42,34;
	end;
L_5x5:
	callfunc "F_LO5LightFlip",41,40,0,0,34;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",41;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,58,171,5	script	light5_42	139,{
	callfunc "F_LO5LightFlip",42,41,49,0,35;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",42;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,40,174,5	script	light5_43	139,{
	callfunc "F_LO5LightFlip",43,0,0,44,36;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",43;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,43,174,5	script	light5_44	139,{
	callfunc "F_LO5LightFlip",44,43,0,45,37;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",44;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,46,174,5	script	light5_45	139,{
	callfunc "F_LO5LightFlip",45,44,0,46,38;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",45;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,49,174,5	script	light5_46	139,{
	callfunc "F_LO5LightFlip",46,45,0,47,39;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",46;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,52,174,5	script	light5_47	139,{
	callfunc "F_LO5LightFlip",47,46,0,48,40;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",47;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,55,174,5	script	light5_48	139,{
	callfunc "F_LO5LightFlip",48,47,0,49,41;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",48;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}
lightsout5,58,174,5	script	light5_49	139,{
	callfunc "F_LO5LightFlip",49,48,0,0,42;
	end;
OnFlip:
//	specialeffect 427;
	specialeffect 423;
	end;
OnEnd:
	callfunc "F_LO5LightEnd",49;
	end;
OnAni:
	callfunc "F_LO5LightAni";
	end;
}